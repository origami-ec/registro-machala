<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/bpmTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:co="http://xmlns.jcp.org/jsf/composite/co">

    <ui:define name="title">Tareas por Usuario</ui:define>
    <ui:define name="content">
        <h:form id="frmMain">
            <div >
                <p:panelGrid columns="2" style="width: 40%">
                    <co:inputSelect catalogo="#{tareasUsuarios.roles}" var="rol1" itemLabel="#{rol1.nombre}" itemValue="#{rol1}"  
                                    label="Rol" value="#{tareasUsuarios.rolFilter}" useConverter="true"  >
                        <p:ajax event="ajax" listener="#{tareasUsuarios.buscarUser()}" update="frmMain:dtgTerasUsuarios" process="frmMain" />
                    </co:inputSelect>
                    <p:commandButton icon="fa fa-search" actionListener="#{tareasUsuarios.buscarUser()}" update="frmMain:dtgTerasUsuarios" process="frmMain"  />
                </p:panelGrid>
                <p:commandButton icon="fa fa-plus" value="Agregar usuario" actionListener="#{tareasUsuarios.setEdicion(true)}"
                                 action="#{tareasUsuarios.dlgSeleccionado(null)}" class="Fright" />
            </div>
            <br/>
            <br/>
            <p:dataGrid value="#{tareasUsuarios.usuariosTareas}" var="ts1" layout="grid" columns="4" lazy="true" paginator="true" rows="8"
                        rowsPerPageTemplate="4,8,16, 20" class="Wid100" id="dtgTerasUsuarios" paginatorPosition="top"  >
                <p:panel header="#{ts1.usuario.usuario}" class="Wid100">
                    <div align="center" style="padding-top: 10px; "><p:graphicImage name="icons/administrator.png" height="50"/></div>
                    <p:panelGrid columns="2" style="width:100%" class="noBorder">
                        <p:outputLabel value="Nombres:" class="FontBold" />
                        <p:outputLabel value="#{ts1.usuario.ente.nombres}" />
                        <p:outputLabel value="Rol:" class="FontBold" />
                        <p:outputLabel value="#{ts1.rol.nombre}" />

                        <p:outputLabel value="Cupo:" class="FontBold" />
                        <h:panelGrid columns="3" class="noBorder Wid100">
                            <p:outputLabel value="#{ts1.peso}"  />
                            <p:outputLabel value="Cantidad:" class="FontBold" />
                            <p:outputLabel value="#{ts1.cantidad}"  />
                        </h:panelGrid>
                        <p:outputLabel value="Dias:" class="FontBold" />
                        <h:panelGrid columns="3" class="noBorder Wid100">
                            <p:outputLabel value="#{ts1.dias}"  />
                            <p:outputLabel value="Cantidad Aux:" class="FontBold" />
                            <p:outputLabel value="#{ts1.cantidadAux}"  />
                        </h:panelGrid>
                        <p:outputLabel value="Fe.Salida:" class="FontBold" />
                        <p:outputLabel value="#{ts1.fechaSalida}">
                            <f:convertDateTime pattern="dd/MMMM/yyyy"/>
                        </p:outputLabel>
                        <p:outputLabel value="Fe.Ingreso:" class="FontBold" />
                        <p:outputLabel value="#{ts1.fechaIngreso}">
                            <f:convertDateTime pattern="dd/MMMM/yyyy"/>
                        </p:outputLabel>
                        <p:outputLabel value="Estado:" class="FontBold" />
                        <p:outputLabel value="#{ts1.estado? 'Activo' : 'Inactivo'}"  />
                    </p:panelGrid>
                    <div align="center" style="padding-top: 10px; ">
                        <h:panelGroup style="text-align: center; align-content: center" >
                            <p:commandButton icon="fa fa-pencil-square-o" actionListener="#{tareasUsuarios.setEdicion(true)}"
                                             action="#{tareasUsuarios.dlgSeleccionado(ts1)}" process="frmDetUser"  title="Editar" />
                            <p:spacer width="10" />
                            <p:commandButton icon="fa fa-info-circle" actionListener="#{tareasUsuarios.setEdicion(false)}" rendered="false"
                                             action="#{tareasUsuarios.dlgSeleccionado(ts1)}" process="frmDetUser" title="Ver" />
                        </h:panelGroup>
                    </div>
                </p:panel>
            </p:dataGrid>
        </h:form>

        <p:dialog id="usuarioTar" header="Detalle de usuario" widgetVar="usuarioTar" modal="true" resizable="false"
                  width="30%" closeOnEscape="true" >
            <h:form id="frmDetUser" >
                <p:panelGrid columns="1" style="width:100%" class="noBorder">
                    <co:inputTextButton label="Usuario" value="#{tareasUsuarios.seleccionado.usuario.usuario}" actionListenerButton="#{tareasUsuarios.buscarUsuario('/resources/dialog/dlglazyusers')}"
                                        isAjaxButton="#{tareasUsuarios.edicion}" listenerAjaxButton="#{tareasUsuarios.procesar}" updateButton="frmDetUser:txtNombre:txtNombre-form"
                                        rendered="#{tareasUsuarios.seleccionado.id eq null}"/>
                    <co:inputText id="txtNombre" label="Nombres" value="#{tareasUsuarios.seleccionado.usuario.ente.nombreCompleto}" readonly="true"   />
                    <co:inputSelect id="cmbRoles" label="Rol" value="#{tareasUsuarios.seleccionado.rol}" catalogo="#{tareasUsuarios.roles}" rendered="true"
                                    var="rol2" itemLabel="#{rol2.nombre}" itemValue="#{rol2}" disabled="#{!tareasUsuarios.edicion}" useConverter="true" />
                    <h:panelGrid columns="2" width="100%">
                        <co:inputDate label="Fecha Salidad" value="#{tareasUsuarios.seleccionado.fechaSalida}" />
                        <co:inputDate label="Fecha Ingreso" value="#{tareasUsuarios.seleccionado.fechaIngreso}" />
                        <co:inputNumber id="txtCupo" label="Cupo" value="#{tareasUsuarios.seleccionado.peso}" decimalPlaces="0"/>
                        <co:inputNumber id="txtDias" label="Dias" value="#{tareasUsuarios.seleccionado.dias}" decimalPlaces="0"/>
                        <co:inputSelectBoolean label="Estado" value="#{tareasUsuarios.seleccionado.estado}" rendered="#{tareasUsuarios.edicion and tareasUsuarios.seleccionado.id ne null}" />
                    </h:panelGrid>
                </p:panelGrid>
                <!--<p:dataTable value="# {tareasUsuarios.seleccionado.tarTareasAsignadasCollection}" var="tta1" 
                        rendered="# {tareasUsuarios.seleccionado.id ne null}"  >
                    <p:column headerText="Cantidad">
                        # {tta1.cantidad}
                    </p:column>
                    <p:column headerText="Peso">
                        # {tta1.peso}
                    </p:column>
                </p:dataTable>-->
                <div align="center" style="padding-top: 10px; ">
                    <p:commandButton value="Guardar" actionListener="#{tareasUsuarios.guardar()}" oncomplete="PF('usuarioTar').hide()" renderDisabledClick="true"
                                     rendered="#{tareasUsuarios.edicion}" update="frmMain, frmMain:dtgTerasUsuarios"/>
                    <p:spacer width="10" />
                    <p:commandButton value="Cerrar" actionListener="#{tareasUsuarios.reloadUsuario()}" oncomplete="PF('usuarioTar').hide()" renderDisabledClick="true" />
                </div>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
