<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                template="/template/bpmTemplate.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="title">Reportes de Recaudación</ui:define>
    <ui:define name="content">
        <h:form id="mainForm">
            <center><h1>REPORTES DE RECAUDACIÓN</h1></center>
            <p:tabView id="mainTab">
                
                <p:tab title="Reportes" id="tabInfoReporte">
                    <p:panel id="panelReportes">
                        <h:panelGrid id="reportes" styleClass="noBorder" columns="2" style="margin: 0 auto; font-weight: bolder">
                            <h:panelGroup>
                                <p:outputLabel value="Tipo Reporte:" /><br></br>
                                <p:selectOneMenu value="#{reportesTesoreria.tipoReporte}" style="width: 250px;">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="#{0}" />
                                    <f:selectItem itemLabel="REPORTE DE RECAUDACION" itemValue="#{1}" />
                                    <f:selectItem itemLabel="RECAUDACIÓN DETALLE" itemValue="#{9}" />
                                    <!-- <f:selectItem itemLabel="FORMAS DE PAGO" itemValue="#{2}" />-->
                                    <f:selectItem itemLabel="FORMAS DE PAGO DETALLE" itemValue="#{4}" />
                                    <f:selectItem itemLabel="FORMAS DE PAGO (CERTIFICADOS)" itemValue="#{20}" />
                                    <f:selectItem itemLabel="FORMAS DE PAGO (INSCRIPCIONES)" itemValue="#{22}" />
                                    <!--<f:selectItem itemLabel="PAGOS EN LÍNEA" itemValue="#{3}" />-->
                                    <f:selectItem itemLabel="DESCUENTOS" itemValue="#{5}" />
                                    <f:selectItem itemLabel="BIESS" itemValue="#{21}" />
                                    <!--<f:selectItem itemLabel="ANULACIONES" itemValue="#{6}" />-->
                                    <f:selectItem itemLabel="FACTURAS ANULADAS" itemValue="#{7}" />
                                    <f:selectItem itemLabel="VALORES EXONERADOS" itemValue="#{8}" />
                                    <f:selectItem itemLabel="SERVICIOS POR CLASE" itemValue="#{10}" />
                                    <f:selectItem itemLabel="CERTIFICADOS INGRESADOS" itemValue="#{17}" />
                                    <f:selectItem itemLabel="INSCRIPCIONES INGRESADAS" itemValue="#{18}" />
                                    <f:selectItem itemLabel="REPORTE POR USUARIO" itemValue="#{23}" />
                                    <!--<f:selectItem itemLabel="PROFORMAS INACTIVAS" itemValue="#{19}" />-->
                                    <!--<f:selectItem itemLabel="TAREAS ASIGNADAS" itemValue="#{11}" />-->
                                    <!--<f:selectItem itemLabel="NOTAS DE CREDITO" itemValue="#{12}" />-->
                                    <!--<f:selectItem itemLabel="REMANENTES-PROPIEDAD" itemValue="#{14}" />-->
                                    <!--<f:selectItem itemLabel="REMANENTES-MERCANTIL" itemValue="#{15}" />-->
                                    <!--<f:selectItem itemLabel="PROFORMAS REALIZADAS" itemValue="#{16}" />-->
                                    <p:ajax update="panelReportes"/>
                                </p:selectOneMenu>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{reportesTesoreria.tipoReporte ne 3}"  >
                                <p:outputLabel value="Usuarios:" /><br></br>
                                <p:selectOneMenu value="#{reportesTesoreria.user}" disabled="#{reportesTesoreria.tipoReporte eq 23}" converter="entityConverter" style="width: 200px;">
                                    <f:selectItem itemLabel="TODOS" itemValue="#{null}"/>
                                    <f:selectItems value="#{reportesTesoreria.cajeros}" var="caj" itemLabel="#{caj.usuario}" itemValue="#{caj}"/>
                                </p:selectOneMenu> 
                            </h:panelGroup>
                            <h:panelGroup rendered="#{reportesTesoreria.tipoReporte eq 3}"  >
                                <p:outputLabel value="" /><br></br>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{reportesTesoreria.tipoReporte eq 6 or reportesTesoreria.tipoReporte eq 7}">
                                <p:outputLabel value="Desde:" /><br></br>
                                <p:calendar value="#{reportesTesoreria.desde}" pattern="dd/MM/yyyy" style="width: 200px"/>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{reportesTesoreria.tipoReporte eq 6 or reportesTesoreria.tipoReporte eq 7}">
                                <p:outputLabel value="Hasta:" /><br></br>
                                <p:calendar value="#{reportesTesoreria.hasta}" pattern="dd/MM/yyyy"/>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{reportesTesoreria.tipoReporte ne 6 and reportesTesoreria.tipoReporte ne 7}" >
                                <p:outputLabel value="Desde:" /><br></br>
                                <p:calendar value="#{reportesTesoreria.desde}" pattern="dd/MM/yyyy HH:mm"/><br></br>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{reportesTesoreria.tipoReporte ne 6 and reportesTesoreria.tipoReporte ne 7}" >
                                <p:outputLabel value="Hasta:" /><br></br>
                                <p:calendar value="#{reportesTesoreria.hasta}" pattern="dd/MM/yyyy HH:mm"/>
                            </h:panelGroup>
                        </h:panelGrid>
                        <br></br>
                        <center>
                            <p:commandButton value="Reporte PDF" icon="pi pi-file-pdf" style="background-color: darkred;"
                                             actionListener="#{reportesTesoreria.generarReportes(false)}"/>
                            <p:spacer width="30"/>
                            <p:commandButton value="Reporte EXCEL" icon="pi pi-file-excel" style="background-color: darkgreen;" 
                                             actionListener="#{reportesTesoreria.generarReportes(true)}"/>
                        </center>
                    </p:panel>
                </p:tab>

                <p:tab title="Consultas" id="tabInfoConsulta" rendered="false">
                    <p:panel id="panelConsultas">
                        <h:panelGrid id="consultas" columns="1" style="margin: 0 auto;">
                            <h:panelGroup>
                                <p:outputLabel value="Tipo Consulta:" /><br></br>
                                <p:selectOneMenu value="#{reportesTesoreria.tipoConsulta}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="#{0}" />
                                    <f:selectItem itemLabel="CONSULTA POR SOLICITANTE E INTERVINIENTE" itemValue="#{1}" />
                                    <p:ajax update="panelConsultas"/>
                                </p:selectOneMenu>
                            </h:panelGroup>
                            <p:row rendered="#{reportesTesoreria.tipoConsulta eq 1}">
                                <p:column></p:column>
                                <p:column>
                                    <p:inputText value="#{reportesTesoreria.solicitanteInterviniente.nombreCompleto}" size="39" readonly="true"/>
                                </p:column>
                                <p:column>
                                    <p:commandButton value="Buscar" icon="ui-icon-search" styleClass="btnStyle" actionListener="#{reportesTesoreria.showDlg('/resources/dialog/dlglazyente')}">
                                        <p:ajax event="dialogReturn" listener="#{reportesTesoreria.selectObject}" update="consultas"/>
                                    </p:commandButton>
                                </p:column>                            
                            </p:row> 
                        </h:panelGrid> 
                        <p:panelGrid styleClass="noBorder" style="margin: 0 auto;">
                            <p:row rendered="#{reportesTesoreria.tipoConsulta eq 1}">
                                <p:column>Desde:</p:column>
                                <p:column>
                                    <p:calendar value="#{reportesTesoreria.desde2}" pattern="dd/MM/yyyy HH:mm"/>
                                </p:column>
                                <p:column>Hasta:</p:column>
                                <p:column>
                                    <p:calendar value="#{reportesTesoreria.hasta2}" pattern="dd/MM/yyyy HH:mm"/>
                                </p:column>
                            </p:row>                         
                        </p:panelGrid>  
                        <p:panelGrid styleClass="noBorder" style="margin: 0 auto;" columns="3">
                            <p:commandButton value="Consultar" icon="ui-icon-search" styleClass="btnStyle" actionListener="#{reportesTesoreria.generarConsulta()}"/>
                            <p:commandButton value="Reporte Pdf" icon="ui-icon-document" styleClass="btnStyle" actionListener="#{reportesTesoreria.generarDocumento(false)}"/>
                            <p:commandButton value="Reporte Excel" icon="ui-icon-document" styleClass="btnStyle" actionListener="#{reportesTesoreria.generarDocumento(true)}"/>
                        </p:panelGrid>                    
                    </p:panel>
                    <br></br>
                    <p:dataTable reflow="true" paginator="true" lazy="true" rows="20" rowsPerPageTemplate="20,50,100" filterEvent="enter" scrollable="true" scrollWidth="97%"
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 value="#{reportesTesoreria.solic_interv}" var="sol" emptyMessage="No se encontro ningun Item" rendered="#{reportesTesoreria.tipoConsulta eq 1}" resizableColumns="true" 
                                 rowKey="#{sol.tramite}" selectionMode="single">                        
                        <f:facet name="header">RESULTADO DE CONSULTA</f:facet>
                        <p:column headerText="Tramite" width="65">
                            #{sol.tramite}
                        </p:column>
                        <p:column headerText="Factura" width="75">
                            #{sol.factura}
                        </p:column>
                        <p:column headerText="Fecha Ingreso" width="100">
                            <h:outputText value="#{sol.fechaingreso}"><f:convertDateTime pattern="dd/MM/yyyy HH:mm"/></h:outputText>
                        </p:column>
                        <p:column headerText="Tramitador" width="150">
                            #{sol.tramitador}
                        </p:column>
                        <p:column headerText="Estudio Juridico" width="150">
                            #{sol.estudioJuridico}
                        </p:column>                        
                        <p:column headerText="Informacion Adicional" width="150">
                            #{sol.infAdicional}
                        </p:column>
                        <p:column headerText="Valor Facturado" width="100">
                            #{sol.valor_fact}
                        </p:column>
                    </p:dataTable>
                </p:tab>

                <p:tab title="Reportes Historicos" id="tabInfoReporteHist" rendered="false">
                    <p:panel id="panelReportesHist">
                        <p:panelGrid id="reportesHist" styleClass="noBorder" style="margin: 0 auto;">
                            <p:row>
                                <p:column>Tipo Reporte:</p:column>    
                                <p:column colspan="3">
                                    <p:selectOneMenu value="#{reportesTesoreria.tipoReporteHist}">
                                        <f:selectItem itemLabel="Seleccionar" itemValue="#{0}" />
                                        <f:selectItem itemLabel="CUADRE DE CAJA" itemValue="#{1}" />
                                        <f:selectItem itemLabel="DESCUENTOS POR LEY" itemValue="#{2}" />
                                        <f:selectItem itemLabel="DESCUENTOS POR LIMITE" itemValue="#{3}" />
                                        <f:selectItem itemLabel="FACTURAS ANULADAS" itemValue="#{4}" />
                                        <!--<f:selectItem itemLabel="FACTURAS INGRESADAS POR EL BIESS" itemValue="#{5}" /> -->
                                        <f:selectItem itemLabel="DETALLE DE CONTRATOS" itemValue="#{6}" />
                                        <p:ajax update="panelReportesHist"/>
                                    </p:selectOneMenu>
                                </p:column>
                            </p:row>  
                            <p:row>
                                <p:column>Desde:</p:column>
                                <p:column>
                                    <p:calendar value="#{reportesTesoreria.desde3}" pattern="dd/MM/yyyy HH:mm"/>
                                </p:column>
                                <p:column>Hasta:</p:column>
                                <p:column>
                                    <p:calendar value="#{reportesTesoreria.hasta3}" pattern="dd/MM/yyyy HH:mm"/>
                                </p:column>
                            </p:row>                        
                            <p:row>
                                <p:column>
                                    <p:commandButton value="Reporte PDF" icon="ui-icon-document" styleClass="btnStyle" actionListener="#{reportesTesoreria.generarReportesHist(false)}"/>
                                </p:column>
                                <p:column>
                                    <p:commandButton value="Reporte XLS" icon="ui-icon-document" styleClass="btnStyle" actionListener="#{reportesTesoreria.generarReportesHist(true)}"/>
                                </p:column>
                            </p:row>                    
                        </p:panelGrid>
                    </p:panel>
                </p:tab>
            </p:tabView>
        </h:form>
    </ui:define>
</ui:composition>