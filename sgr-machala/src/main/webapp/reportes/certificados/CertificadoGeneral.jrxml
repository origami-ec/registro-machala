<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="CertificadoGeneral" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="455" leftMargin="70" rightMargin="70" topMargin="0" bottomMargin="0" isFloatColumnFooter="true" uuid="eaca66aa-9595-4c19-ac4e-47317721d91a">
	<property name="ireport.zoom" value="2.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="negrita" pdfFontName="Helvetica-Bold"/>
	<parameter name="ID_CERTIFICADO" class="java.lang.Long"/>
	<parameter name="WATERMARK_URL" class="java.lang.String"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["C:\\app_server\\apache-tomee-plus-1.7.1\\webapps\\rpp\\reportes\\registro\\"]]></defaultValueExpression>
	</parameter>
	<parameter name="REGISTRADOR" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT c.num_certificado, c.tipo_certificado, c.estado_mensaje, c.descripcion_bien,
coalesce(en.apellidos, '') || ' ' || coalesce(en.nombres, '') as usuario,
(to_char(c.fecha_emision, 'yyyy')||'-'||c.num_tramite)
as codigo_certificado, fi.num_ficha, c.con_bienes, ac.nombre as nombre_certificado,
c.cod_verificacion, liq.codigo_comprobante comprobante,
(select valor_string from conf.valores where code = 'URL_VALIDACION_DOCUMENTOS')
|| c.cod_verificacion as qrcode,
c.nombre_solicitante, c.uso_documento, us.usuario as certificador,
c.fecha_emision, liq.codigo_comprobante, liq.numero_autorizacion,
(select valor from conf.contenido_reportes where code = 'NOTAS_ACLARATORIAS' and estado = 'A') as notas_aclaratorias,
us.firma_nombre as firma_nombre1, us.firma_cargo as firma_cargo1,
je.firma_nombre as firma_nombre2, je.firma_cargo as firma_cargo2, je.usuario as user_jefe
FROM app.reg_certificado c
left join app.acl_user us on (us.id = c.user_creador)
left join app.acl_user je on (je.id = c.jefe_certificados)
left join app.cat_ente en on (en.id = us.ente)
left join flow.regp_tareas_tramite tt on (tt.id = c.tarea_tramite)
left join flow.regp_liquidacion_detalles de on (de.id = tt.detalle)
left join flow.regp_liquidacion liq on liq.id = de.liquidacion
left join app.reg_acto ac on (de.acto = ac.id)
left join app.reg_libro li on (li.id = ac.libro)
left join app.reg_ficha fi on (fi.id = c.ficha)
where c.id = $P{ID_CERTIFICADO}]]>
	</queryString>
	<field name="num_certificado" class="java.lang.Long"/>
	<field name="tipo_certificado" class="java.lang.Long"/>
	<field name="estado_mensaje" class="java.lang.Integer"/>
	<field name="descripcion_bien" class="java.lang.String"/>
	<field name="usuario" class="java.lang.String"/>
	<field name="codigo_certificado" class="java.lang.String"/>
	<field name="num_ficha" class="java.lang.Long"/>
	<field name="con_bienes" class="java.lang.Boolean"/>
	<field name="nombre_certificado" class="java.lang.String"/>
	<field name="cod_verificacion" class="java.lang.String"/>
	<field name="comprobante" class="java.lang.String"/>
	<field name="qrcode" class="java.lang.String"/>
	<field name="nombre_solicitante" class="java.lang.String"/>
	<field name="uso_documento" class="java.lang.String"/>
	<field name="certificador" class="java.lang.String"/>
	<field name="fecha_emision" class="java.sql.Timestamp"/>
	<field name="codigo_comprobante" class="java.lang.String"/>
	<field name="numero_autorizacion" class="java.lang.String"/>
	<field name="notas_aclaratorias" class="java.lang.String"/>
	<field name="firma_nombre1" class="java.lang.String"/>
	<field name="firma_cargo1" class="java.lang.String"/>
	<field name="firma_nombre2" class="java.lang.String"/>
	<field name="firma_cargo2" class="java.lang.String"/>
	<field name="user_jefe" class="java.lang.String"/>
	<background>
		<band height="840" splitType="Stretch">
			<image scaleImage="FillFrame" hAlign="Center" vAlign="Middle">
				<reportElement x="-70" y="0" width="595" height="840" uuid="4977f6a7-c9b5-4deb-a7e4-b5181d4c2e45"/>
				<imageExpression><![CDATA[$P{WATERMARK_URL}]]></imageExpression>
			</image>
		</band>
	</background>
	<pageHeader>
		<band height="80" splitType="Stretch"/>
	</pageHeader>
	<detail>
		<band height="55" splitType="Stretch">
			<staticText>
				<reportElement style="negrita" positionType="Float" x="0" y="0" width="130" height="14" uuid="5bf4b59c-ac50-4453-beb6-5233f43c785f"/>
				<textElement verticalAlignment="Middle">
					<font size="10" isBold="false"/>
				</textElement>
				<text><![CDATA[Nº de Certificado:]]></text>
			</staticText>
			<textField pattern="" isBlankWhenNull="true">
				<reportElement positionType="Float" x="130" y="14" width="265" height="14" uuid="d69ab815-796f-4e0e-8dc2-c817c46e3f45"/>
				<textElement verticalAlignment="Middle">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha_emision}]]></textFieldExpression>
				<patternExpression><![CDATA["dd MMMMM yyyy HH:mm"]]></patternExpression>
			</textField>
			<textField pattern="" isBlankWhenNull="true">
				<reportElement positionType="Float" x="130" y="0" width="265" height="14" uuid="5b2105c3-9143-48df-8899-abe53a34ae0b"/>
				<textElement verticalAlignment="Middle">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[java.lang.String.format("%08d", $F{num_certificado}) + "-" + $F{codigo_certificado}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement style="negrita" positionType="Float" x="0" y="14" width="130" height="14" uuid="d2a6774d-6fcc-435c-91ec-63c39ee78ea1"/>
				<textElement verticalAlignment="Middle">
					<font size="10" isBold="false"/>
				</textElement>
				<text><![CDATA[Fecha de Emisión:]]></text>
			</staticText>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="negrita" mode="Opaque" x="0" y="30" width="455" height="17" isPrintWhenDetailOverflows="true" backcolor="#CCCCCC" uuid="b52c1c55-f861-4959-b2da-7c56cf7f477e"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{descripcion_bien} == null ? "CERTIFICACIÓN" : $F{descripcion_bien}]]></textFieldExpression>
			</textField>
		</band>
		<band height="14" splitType="Stretch">
			<subreport>
				<reportElement x="0" y="0" width="455" height="14" uuid="49896668-52b3-4b5f-98ca-dabb6bfc0f1a"/>
				<subreportParameter name="ID_CERTIFICADO">
					<subreportParameterExpression><![CDATA[$P{ID_CERTIFICADO}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "CertificadoGeneral_contenido.jasper"]]></subreportExpression>
			</subreport>
		</band>
		<band height="20" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement positionType="Float" x="0" y="0" width="455" height="16" isRemoveLineWhenBlank="true" isPrintWhenDetailOverflows="true" uuid="9e98196b-a946-41f7-a5ae-1cb59a049ca7"/>
				<textElement textAlignment="Justified" verticalAlignment="Middle" markup="styled">
					<font size="11" isBold="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["<style pdfFontName=\"Helvetica-Bold\">MOTIVO: </style>El presente certificado se lo extiende para los fines solicitados por <style pdfFontName=\"Helvetica-Bold\">" + $F{nombre_solicitante}.toUpperCase() +
"</style> el mismo que servirá para <style pdfFontName=\"Helvetica-Bold\">" + $F{uso_documento}.toUpperCase() + "</style> de acuerdo a la solicitud presentada por el usuario."]]></textFieldExpression>
			</textField>
		</band>
		<band height="20" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="0" y="0" width="455" height="11" isRemoveLineWhenBlank="true" isPrintWhenDetailOverflows="true" uuid="f9d82d1f-cacd-4bb1-b5cd-e2bfab907e43"/>
				<textElement textAlignment="Justified" verticalAlignment="Middle" markup="none">
					<font size="6"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{notas_aclaratorias}]]></textFieldExpression>
			</textField>
		</band>
		<band height="116" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement style="negrita" isPrintRepeatedValues="false" x="0" y="74" width="250" height="42" isPrintWhenDetailOverflows="true" uuid="8b32f6a8-a403-4486-b6d7-2f92cd7c0ec7"/>
				<box>
					<topPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Top">
					<font size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{REGISTRADOR}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="355" y="0" width="100" height="12" isPrintWhenDetailOverflows="true" uuid="867045d8-77d9-42f9-ad8d-28ddc5b41959">
					<printWhenExpression><![CDATA[$F{cod_verificacion} != null]]></printWhenExpression>
				</reportElement>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<text><![CDATA[Código de Verificación]]></text>
			</staticText>
			<textField>
				<reportElement style="negrita" isPrintRepeatedValues="false" x="355" y="12" width="100" height="14" isPrintWhenDetailOverflows="true" uuid="9d3afb5b-c786-4d5d-a4e2-95571ba93b53">
					<printWhenExpression><![CDATA[$F{cod_verificacion} != null]]></printWhenExpression>
				</reportElement>
				<textElement verticalAlignment="Middle">
					<font size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cod_verificacion}]]></textFieldExpression>
			</textField>
			<image>
				<reportElement x="365" y="26" width="90" height="90" isPrintWhenDetailOverflows="true" uuid="467e01d9-3234-40d0-9665-eb100ccc39f8">
					<printWhenExpression><![CDATA[$F{cod_verificacion} != null]]></printWhenExpression>
				</reportElement>
				<imageExpression><![CDATA[com.google.zxing.client.j2se.MatrixToImageWriter.toBufferedImage(
    new com.google.zxing.qrcode.QRCodeWriter().encode(
        $F{qrcode},
        com.google.zxing.BarcodeFormat.QR_CODE, 300, 300
    ))]]></imageExpression>
			</image>
		</band>
	</detail>
	<pageFooter>
		<band height="60" splitType="Stretch">
			<textField>
				<reportElement x="335" y="0" width="80" height="12" uuid="fe8081b8-d8c0-4b1e-89bc-cfcf2a155a74"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["Página "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="415" y="0" width="40" height="12" uuid="a4f03298-0fb5-47fb-82c6-687454c1253d"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement positionType="Float" x="80" y="24" width="67" height="9" isPrintWhenDetailOverflows="true" uuid="296e7d94-fd45-4ce4-89a1-8499c78fef1b"/>
				<textElement verticalAlignment="Middle">
					<font size="6" isBold="false"/>
				</textElement>
				<text><![CDATA[Elaborado por:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement positionType="Float" x="147" y="24" width="110" height="9" isPrintWhenDetailOverflows="true" uuid="5865edda-f18e-4c51-8de1-0defc0eea7e0"/>
				<textElement verticalAlignment="Middle">
					<font size="6" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{certificador}.toUpperCase()]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement positionType="Float" x="257" y="24" width="70" height="9" isPrintWhenDetailOverflows="true" uuid="6aad8db8-4581-46fe-a3f2-0d35b76fac81"/>
				<textElement verticalAlignment="Middle">
					<font fontName="SansSerif" size="6" isBold="false"/>
				</textElement>
				<text><![CDATA[N° Comprobante:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement positionType="Float" x="327" y="24" width="113" height="9" isPrintWhenDetailOverflows="true" uuid="83f7d35f-3ec3-48f0-b9b4-d038412e8c26"/>
				<textElement verticalAlignment="Middle">
					<font size="6"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{comprobante}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="80" y="33" width="67" height="9" isPrintWhenDetailOverflows="true" uuid="e3a1ff8d-9c8a-4cc5-9589-29c8c89d222d"/>
				<textElement verticalAlignment="Middle">
					<font size="6" isBold="false"/>
				</textElement>
				<text><![CDATA[Nro. Certificado:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="147" y="33" width="110" height="9" isPrintWhenDetailOverflows="true" uuid="22fc0d84-12ff-474d-996b-e52f2116859a"/>
				<textElement verticalAlignment="Middle">
					<font size="6" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[java.lang.String.format("%08d", $F{num_certificado}) + "-" + $F{codigo_certificado}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement positionType="Float" x="257" y="33" width="70" height="9" isPrintWhenDetailOverflows="true" uuid="bdfdb9c0-a80a-453b-8a5a-44941bf5f0a0"/>
				<textElement verticalAlignment="Middle">
					<font fontName="SansSerif" size="6" isBold="false"/>
				</textElement>
				<text><![CDATA[Fecha Emisión:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy HH:mm" isBlankWhenNull="true">
				<reportElement x="327" y="33" width="113" height="9" isPrintWhenDetailOverflows="true" uuid="66442cf0-689e-48ac-a3cb-df1f2efe5983"/>
				<textElement verticalAlignment="Middle">
					<font size="6" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha_emision}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>
