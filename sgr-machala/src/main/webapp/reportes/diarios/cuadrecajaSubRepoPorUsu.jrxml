<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="cuadrecajaInscripciones" language="groovy" pageWidth="555" pageHeight="802" columnWidth="555" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" isIgnorePagination="true" uuid="339dfa01-0d28-41cc-9143-da79a9ad5430">
	<property name="ireport.zoom" value="1.948717100000005"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="ANULADA" mode="Opaque" forecolor="#000000" backcolor="#FF9999"/>
	<style name="negrita" pdfFontName="Helvetica-Bold"/>
	<parameter name="DESDE" class="java.lang.String"/>
	<parameter name="HASTA" class="java.lang.String"/>
	<parameter name="USUARIO" class="java.lang.Long"/>
	<queryString>
		<![CDATA[select distinct
  li.num_tramite_rp,
  pa.fecha_pago,
  pa.valor,
  case
    when ac.solvencia is true then 'CERTIFICACION'
    else 'INSCRIPCION'
  end as tipo_tramite,
  CASE
            WHEN en.es_persona THEN COALESCE(en.apellidos,'') || ' ' || COALESCE(en.nombres,'')
            ELSE en.razon_social
        END AS solicitante,
en.ci_ruc
from flow.regp_liquidacion li
left join financiero.ren_pago pa on li.id = pa.liquidacion and li.fecha_ingreso::date = pa.fecha_pago::date
left join flow.regp_liquidacion_detalles det on det.liquidacion = li.id
left join app.reg_acto ac on ac.id = det.acto
left join app.cat_ente en on en.id = li.beneficiario
where pa.cajero = $P{USUARIO}
  and pa.fecha_pago between
    to_timestamp($P{DESDE}, 'DD/MM/YYYY HH24:MI')::timestamp without time zone
    and to_timestamp($P{HASTA}, 'DD/MM/YYYY HH24:MI')::timestamp without time zone
union all
select distinct
li.num_tramite_rp,
pa.fecha_pago,
pa.valor,
case
    when ac.solvencia is true then 'CERTIFICACION'
    else 'INSCRIPCION'
  end as tipo_tramite,
   CASE
            WHEN en.es_persona THEN COALESCE(en.apellidos,'') || ' ' || COALESCE(en.nombres,'')
            ELSE en.razon_social
        END AS solicitante,
en.ci_ruc
from financiero.ren_factura fact
left join financiero.ren_pago pa on pa.id = fact.pago
left join flow.regp_liquidacion li on li.id = fact.liquidacion
left join flow.regp_liquidacion_detalles det on det.liquidacion = li.id and pa.fecha_pago::date = det.fecha_ingreso::date
left join app.reg_acto ac on ac.id = det.acto
left join app.cat_ente en on en.id = fact.solicitante
where pa.cajero = $P{USUARIO}
  and pa.fecha_pago between
    to_timestamp($P{DESDE}, 'DD/MM/YYYY HH24:MI')::timestamp without time zone
    and to_timestamp($P{HASTA}, 'DD/MM/YYYY HH24:MI')::timestamp without time zone
order by 4, 2, 1;]]>
	</queryString>
	<field name="num_tramite_rp" class="java.lang.Long"/>
	<field name="fecha_pago" class="java.sql.Timestamp"/>
	<field name="valor" class="java.math.BigDecimal"/>
	<field name="tipo_tramite" class="java.lang.String"/>
	<field name="solicitante" class="java.lang.String"/>
	<field name="ci_ruc" class="java.lang.String"/>
	<variable name="SUM_TOTAL" class="java.math.BigDecimal" resetType="Group" resetGroup="TipoTramite" calculation="Sum">
		<variableExpression><![CDATA[$F{valor}]]></variableExpression>
		<initialValueExpression><![CDATA[]]></initialValueExpression>
	</variable>
	<group name="TipoTramite">
		<groupExpression><![CDATA[$F{tipo_tramite}]]></groupExpression>
		<groupHeader>
			<band height="29">
				<staticText>
					<reportElement mode="Opaque" x="0" y="15" width="35" height="14" backcolor="#CCCCCC" uuid="3dcf7897-73e5-4e9c-8e4a-ff5dea1adca1"/>
					<box>
						<topPen lineWidth="0.4"/>
						<leftPen lineWidth="0.4"/>
						<bottomPen lineWidth="0.4"/>
						<rightPen lineWidth="0.4"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Trámite]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Opaque" x="35" y="15" width="87" height="14" backcolor="#CCCCCC" uuid="a3c43ee4-cf3d-4ed8-9171-a85bb5f56682"/>
					<box>
						<topPen lineWidth="0.4"/>
						<leftPen lineWidth="0.4"/>
						<bottomPen lineWidth="0.4"/>
						<rightPen lineWidth="0.4"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Fecha]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Opaque" x="122" y="15" width="348" height="14" backcolor="#CCCCCC" uuid="1cb0712c-6f3b-445b-9e07-086791b83178"/>
					<box>
						<topPen lineWidth="0.4"/>
						<leftPen lineWidth="0.4"/>
						<bottomPen lineWidth="0.4"/>
						<rightPen lineWidth="0.4"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Apellidos y Nombres]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Opaque" x="470" y="15" width="45" height="14" backcolor="#CCCCCC" uuid="197f25ad-1fdc-48e3-b0b5-ae613f65142f"/>
					<box>
						<topPen lineWidth="0.4"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.4"/>
						<rightPen lineWidth="0.4"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Total]]></text>
				</staticText>
				<textField>
					<reportElement x="0" y="0" width="161" height="15" uuid="1f9295f3-2b21-4e08-8fb1-7c63fa70a853"/>
					<textFieldExpression><![CDATA[$F{tipo_tramite}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="21">
				<textField pattern="¤ #,##0.00">
					<reportElement x="470" y="0" width="45" height="19" uuid="94219836-98b3-401b-ae95-dbca98651f75"/>
					<box>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center">
						<font size="6"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{SUM_TOTAL}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<detail>
		<band height="17" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="0" y="0" width="35" height="17" isPrintWhenDetailOverflows="true" uuid="4fd86add-f611-4720-b307-4d59c5867e2f"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.4"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{num_tramite_rp}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="35" y="0" width="87" height="17" isPrintWhenDetailOverflows="true" uuid="06ea8e35-1c85-4f2a-b7b6-24d40fb347e2"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha_pago}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="122" y="0" width="348" height="17" isPrintWhenDetailOverflows="true" uuid="c42eb5aa-f7ef-40d9-97ab-c66449bf50e5"/>
				<box leftPadding="2">
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ci_ruc} + " / " + $F{solicitante}.toUpperCase()]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="470" y="0" width="45" height="17" isPrintWhenDetailOverflows="true" uuid="3bf683e2-611f-4fe7-915a-b9ff930aa043"/>
				<box rightPadding="1">
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.4"/>
					<rightPen lineWidth="0.4"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="6"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{valor}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
