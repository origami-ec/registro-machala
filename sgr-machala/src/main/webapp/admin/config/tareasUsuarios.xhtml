<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/bpmTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:co="http://xmlns.jcp.org/jsf/composite/co">
    <ui:define name="title">Asignación Automática</ui:define>
    <ui:define name="content">
        <h:form id="frmMain">
            <center><h1>ASIGNACIÓN AUTOMÁTICA</h1></center>
            <h:panelGrid columns="4" style="width: 100%;">
                <co:inputSelect catalogo="#{tareasUsuarios.roles}" var="rol1" itemLabel="#{rol1.nombre}" itemValue="#{rol1}" 
                                label="Roles de Usuario:" value="#{tareasUsuarios.rolFilter}" useConverter="true">
                    <p:ajax event="ajax" listener="#{tareasUsuarios.buscarUser()}" update="frmMain:dtgTerasUsuarios" process="frmMain" />
                </co:inputSelect>
                <p:spacer width="100" height="1"/>
                <p:spacer width="100" height="1"/>
                <p:commandButton icon="pi pi-user-plus" value="Agregar Usuario" actionListener="#{tareasUsuarios.setEdicion(true)}"
                                 action="#{tareasUsuarios.dlgSeleccionado(null)}" style="float: right;"/>
            </h:panelGrid>
            <p:dataTable id="dtgTerasUsuarios" reflow="true" paginator="true" lazy="true" rows="10" rowsPerPageTemplate="10,50,100" filterEvent="enter"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         value="#{tareasUsuarios.usuariosTareas}" var="ts1" emptyMessage="No se encontró ningún Item." style="width: 80%;margin: 0 auto;">
                <p:column headerText="***" width="40">
                    <p:graphicImage name="icons/administrator.png" height="40"/>
                </p:column>
                <p:column headerText="Usuario" width="120" filterBy="#{ts1.usuario.usuario}" filterMatchMode="contains" >
                    <h:outputText value="#{ts1.usuario.usuario}"/>
                </p:column>
                <p:column headerText="Apellidos" filterBy="#{ts1.usuario.ente.apellidos}" filterMatchMode="contains" >
                    <h:outputText value="#{ts1.usuario.ente.apellidos}"/>
                </p:column>
                <p:column headerText="Nombres" filterBy="#{ts1.usuario.ente.nombres}" filterMatchMode="contains" >
                    <h:outputText value="#{ts1.usuario.ente.nombres}"/>
                </p:column>
                <p:column headerText="Rol" width="200">
                    <h:outputText value="#{ts1.rol.nombre}"/>
                </p:column>
                <p:column headerText="Asignacion" width="100" rendered="false">
                    <p:outputLabel value="COMPLETA" rendered="#{ts1.cantidadAux eq 1}"/>
                    <p:outputLabel value="MEDIA 50%" rendered="#{ts1.cantidadAux eq 2}"/>
                </p:column>
                <p:column headerText="Estado" width="60">
                    <p:outputLabel value="ACTIVO" rendered="#{ts1.estado}"/>
                    <p:outputLabel value="INACTIVO" rendered="#{!ts1.estado}"/>
                </p:column>
                <p:column headerText="Editar" width="60">
                    <p:commandButton icon="pi pi-pencil" actionListener="#{tareasUsuarios.setEdicion(true)}" 
                                     action="#{tareasUsuarios.dlgSeleccionado(ts1)}" process="frmDetUser" title="Editar" />
                </p:column>
            </p:dataTable>
            <!--<p:dataGrid value="# {tareasUsuarios.usuariosTareas}" var="ts1" layout="grid" columns="4" lazy="true" paginator="true" rows="8"
                        class="Wid100" id="dtgTerasUsuarios" paginatorPosition="top" >
                <p:panel header="# {ts1.usuario.ente.nombres}" class="Wid100">
                    <div align="center" style="padding-top: 10px; ">
                        <p:graphicImage name="icons/administrator.png" height="50"/>
                    </div>
                    <p:panelGrid columns="2" style="width:100%">
                        <p:outputLabel value="Usuario:" style="font-weight: bolder;" />
                        <p:outputLabel value="# {ts1.usuario.usuario}" />
                        <p:outputLabel value="Nombres:" class="FontBold" />
                        <p:outputLabel value="# {ts1.usuario.ente.nombres}" />
                        <p:outputLabel value="Apellidos:" class="FontBold" />
                        <p:outputLabel value="# {ts1.usuario.ente.apellidos}" />
                        <p:outputLabel value="Rol:" class="FontBold" />
                        <p:outputLabel value="# {ts1.rol.nombre}" style="text-transform: uppercase;"/>
                        <p:outputLabel value="Estado:" class="FontBold" />
                        <p:outputLabel value="# {ts1.estado? 'Activo' : 'Inactivo'}"  />
                    </p:panelGrid>
                    <div align="center" style="padding-top: 10px; ">
                        <p:commandButton icon="fa fa-pencil-square-o" actionListener="# {tareasUsuarios.setEdicion(true)}" value="Editar"
                                         action="# {tareasUsuarios.dlgSeleccionado(ts1)}" process="frmDetUser" title="Editar" />
                    </div>
                </p:panel>
            </p:dataGrid>-->
        </h:form>

        <p:dialog id="usuarioTar" header="Detalle de usuario" widgetVar="usuarioTar" modal="true" resizable="false"
                  width="400" closeOnEscape="true" >
            <h:form id="frmDetUser" >
                <h:panelGrid columns="1" style="width:100%;font-weight: bolder;font-size: 14px;" >
                    Usuario de Sistema:
                    <h:panelGrid columns="2">
                        <p:inputText value="#{tareasUsuarios.seleccionado.usuario.usuario}" readonly="true"/>
                        <p:commandButton icon="pi pi-search" 
                                         actionListener="#{tareasUsuarios.buscarUsuario('/resources/dialog/dlglazyusers')}">
                            <p:ajax event="dialogReturn" listener="#{tareasUsuarios.procesar}" update="frmDetUser"/>
                        </p:commandButton>
                    </h:panelGrid>
                    Nombres del Funcionario:
                    <p:inputText value="#{tareasUsuarios.seleccionado.usuario.ente.nombreCompleto}" 
                                 readonly="true" style="width: 100%"/>
                    Rol de Usuario:
                    <p:selectOneMenu value="#{tareasUsuarios.seleccionado.rol}" filter="true" 
                                     style="width: 100%;" converter="entityConverter">
                        <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}" />
                        <f:selectItems value="#{tareasUsuarios.roles}" var="rol" itemLabel="#{rol.nombre}" itemValue="#{rol}"/>
                    </p:selectOneMenu>
                    Estado:
                    <p:selectOneMenu value="#{tareasUsuarios.seleccionado.estado}" style="width: 200px;" >
                        <f:selectItem itemLabel="ACTIVO" itemValue="#{true}" />
                        <f:selectItem itemLabel="INACTIVO" itemValue="#{false}" />
                    </p:selectOneMenu>
                </h:panelGrid>
                <div align="center" style="padding-top: 10px; ">
                    <p:commandButton value="Guardar" actionListener="#{tareasUsuarios.guardar()}" icon="pi pi-save"
                                     oncomplete="PF('usuarioTar').hide()" renderDisabledClick="true"
                                     rendered="#{tareasUsuarios.edicion}" update="frmMain, frmMain:dtgTerasUsuarios"/>
                    <p:spacer width="10" />
                    <p:commandButton value="Cerrar" actionListener="#{tareasUsuarios.reloadUsuario()}" icon="pi pi-ban"
                                     oncomplete="PF('usuarioTar').hide()" renderDisabledClick="true" />
                </div>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
