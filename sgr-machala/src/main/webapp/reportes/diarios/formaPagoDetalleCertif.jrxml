<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="formaPagoDetalleCertif" language="groovy" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="0" bottomMargin="0" uuid="65dc00b9-83f0-4951-a218-a9399e9c6d19">
	<property name="ireport.zoom" value="1.818181818181819"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="136"/>
	<style name="negrita" pdfFontName="Helvetica-Bold"/>
	<parameter name="IMG_URL" class="java.lang.String"/>
	<parameter name="DESDE" class="java.lang.String"/>
	<parameter name="USUARIO" class="java.lang.Long"/>
	<parameter name="TOTAL" class="java.math.BigDecimal"/>
	<parameter name="CANTIDAD" class="java.lang.Integer"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["C:\\Users\\Anyelo\\Desktop\\NetBeansProjects\\portoviejo-registro\\src\\main\\webapp\\reportes\\diarios\\"]]></defaultValueExpression>
	</parameter>
	<parameter name="HASTA" class="java.lang.String"/>
	<parameter name="HASTA_STRING" class="java.lang.String"/>
	<parameter name="TESORERA" class="java.lang.String"/>
	<parameter name="COORDINADORA" class="java.lang.String"/>
	<parameter name="CONTADORA" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
    (
        SELECT
            initcap(coalesce(e.nombres, '') || ' ' || coalesce(e.apellidos, ''))
        FROM app.acl_user us
        LEFT JOIN app.cat_ente e ON e.id = us.ente
        WHERE us.id = $P{USUARIO}
    ) AS recaudador,
    COALESCE(SUM(ins_total),0) AS ins_total,
    COALESCE(SUM(cert_total),0) AS cert_total,
    COALESCE(SUM(total), 0) AS total_global_neto
FROM (
    SELECT p.id,
           CASE WHEN a.solvencia = false THEN p.valor ELSE 0 END AS ins_total,
           CASE WHEN a.solvencia THEN p.valor ELSE 0 END AS cert_total,
           p.valor as total
    FROM financiero.ren_pago p
    LEFT JOIN flow.regp_liquidacion li ON li.id = p.liquidacion
    LEFT JOIN financiero.ren_pago_rubro r ON r.pago = p.id
    LEFT JOIN app.reg_acto a ON a.id = r.rubro
    WHERE li.estado_liquidacion = 2
AND (
        CASE
            WHEN $P{USUARIO} > 0
                THEN li.user_ingreso = $P{USUARIO}
            ELSE
                li.user_ingreso > 0
        END
    )
      AND li.estado_pago = 2
      AND a.solvencia = false
      AND p.fecha_pago BETWEEN
          CAST(to_timestamp($P{DESDE}, 'DD/MM/YYYY HH24:MI') AS timestamp without time zone)
          AND CAST(to_timestamp($P{HASTA}, 'DD/MM/YYYY HH24:MI') AS timestamp without time zone)
    GROUP BY p.valor, a.solvencia, p.id
) t;]]>
	</queryString>
	<field name="recaudador" class="java.lang.String"/>
	<field name="ins_total" class="java.math.BigDecimal"/>
	<field name="cert_total" class="java.math.BigDecimal"/>
	<field name="total_global_neto" class="java.math.BigDecimal"/>
	<background>
		<band height="842" splitType="Stretch">
			<image scaleImage="FillFrame" hAlign="Center" vAlign="Middle">
				<reportElement x="0" y="0" width="555" height="842" uuid="7466f704-5e8f-4578-9c8e-32393baf0b60"/>
				<imageExpression><![CDATA[$P{IMG_URL}]]></imageExpression>
			</image>
		</band>
	</background>
	<pageHeader>
		<band height="49" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="90">
			<staticText>
				<reportElement style="negrita" x="1" y="26" width="555" height="20" uuid="644a3b00-a23b-47aa-857d-5577f9df6428"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="12" isBold="false"/>
				</textElement>
				<text><![CDATA[REPORTE DE RECAUDACIÓN - FORMAS DE PAGO - CERTIFICADOS]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement x="46" y="46" width="128" height="14" uuid="1f0f2a71-fcf1-48b8-8bd8-30b2e948ac43"/>
				<textFieldExpression><![CDATA[$P{DESDE}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="2" y="46" width="44" height="14" uuid="08303ed9-700f-4820-a431-300d85b9e279"/>
				<text><![CDATA[Desde:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="257" y="60" width="218" height="14" uuid="5c2ae979-40a2-4896-8519-4d1fa1456b20"/>
				<textFieldExpression><![CDATA[$P{USUARIO} == 0 ? "TODOS" : $F{recaudador}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="202" y="60" width="55" height="14" uuid="5ae6dc52-45e5-4e6c-a297-275ff782c293"/>
				<text><![CDATA[Cajero:]]></text>
			</staticText>
			<staticText>
				<reportElement x="202" y="46" width="123" height="14" uuid="d18a6b11-8850-46a3-b2ff-a3e86333fa77"/>
				<text><![CDATA[Fecha de Impresión:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement x="325" y="46" width="150" height="14" uuid="eb8e24d5-3b63-42d7-8818-7c811d162c74"/>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="1" y="74" width="555" height="1" uuid="24b95810-c346-42d4-8ba7-75fbf73a28c7"/>
			</line>
			<staticText>
				<reportElement x="2" y="60" width="44" height="14" uuid="67cb7064-c22c-460c-94ef-952c42b00042"/>
				<text><![CDATA[Hasta:]]></text>
			</staticText>
			<textField>
				<reportElement x="46" y="60" width="128" height="14" uuid="0a3cd59c-74b9-4bfa-a23c-3a861afdf327"/>
				<textFieldExpression><![CDATA[$P{HASTA_STRING}]]></textFieldExpression>
			</textField>
		</band>
	</columnHeader>
	<detail>
		<band height="135" splitType="Stretch">
			<subreport>
				<reportElement positionType="Float" x="0" y="0" width="555" height="15" isRemoveLineWhenBlank="true" uuid="eb0a60c7-a6d7-4c08-9777-941a80ffda25"/>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "formasPago_chequeCertif.jasper"]]></subreportExpression>
			</subreport>
			<subreport>
				<reportElement positionType="Float" x="0" y="15" width="555" height="15" isRemoveLineWhenBlank="true" uuid="e0736713-7a66-48db-a045-89e6eabed7b4"/>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "formasPago_nota_creditoCertif.jasper"]]></subreportExpression>
			</subreport>
			<subreport>
				<reportElement positionType="Float" x="0" y="30" width="555" height="15" uuid="ef7e87f8-6e1a-4904-86ab-500babbc2cff"/>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "formasPago_transferenciaCertif.jasper"]]></subreportExpression>
			</subreport>
			<subreport>
				<reportElement positionType="Float" x="0" y="45" width="555" height="15" uuid="eef73e21-4749-4012-aa82-c370a4fa4e99"/>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "formasPago_tajetaCertif.jasper"]]></subreportExpression>
			</subreport>
			<subreport>
				<reportElement positionType="Float" x="0" y="60" width="555" height="15" uuid="cc5fa53f-d198-48ec-88a7-65588c7f66ba"/>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "formasPagoDepositoMachalaCertif.jasper"]]></subreportExpression>
			</subreport>
			<subreport>
				<reportElement positionType="Float" x="0" y="75" width="555" height="15" uuid="ebb90ca4-a7d1-4c6d-8aa0-e0e942db8516"/>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "formasPagoDepositoPacificoCertif.jasper"]]></subreportExpression>
			</subreport>
			<subreport>
				<reportElement positionType="Float" x="0" y="120" width="556" height="15" uuid="8002a411-3fdc-4615-bc9b-6077e99b3802"/>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "formaPago21205Certif.jasper"]]></subreportExpression>
			</subreport>
			<subreport>
				<reportElement positionType="Float" x="0" y="90" width="555" height="14" uuid="6e0f0c86-e7b6-4427-910d-46fcbde8e46f"/>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "formaPagoDepositoProdubancoCert.jasper"]]></subreportExpression>
			</subreport>
			<subreport>
				<reportElement positionType="Float" x="0" y="104" width="555" height="16" uuid="ee941e1a-c6b2-4001-b62b-e1c2e7908766"/>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "formaPagoDepositoPacificoGADCert.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</detail>
	<pageFooter>
		<band height="51" splitType="Stretch">
			<textField evaluationTime="Report">
				<reportElement x="529" y="2" width="25" height="14" uuid="0d00c760-9faa-4f19-9c66-27f50d8ff9a7"/>
				<textElement verticalAlignment="Bottom">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement positionType="Float" x="490" y="2" width="39" height="14" uuid="563e37c1-4dc0-4242-9628-1489fc56649d"/>
				<textElement verticalAlignment="Bottom">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["Pág "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="115" y="2" width="123" height="14" uuid="039acba7-08d7-4b95-a529-58cda7bf8bc9"/>
				<text><![CDATA[Fecha de Impresión:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement x="238" y="2" width="150" height="14" uuid="91b38cc3-a1b6-4c99-a59c-6b2fae77d5de"/>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="118" splitType="Stretch">
			<staticText>
				<reportElement style="negrita" x="298" y="38" width="100" height="14" uuid="ec7ff972-6ee9-4175-b549-633647aeb9bc"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[TOTAL NETO:]]></text>
			</staticText>
			<textField pattern="¤ #,##0.00" isBlankWhenNull="true">
				<reportElement x="398" y="10" width="118" height="14" uuid="1999b4ec-ce78-45bf-aa67-58b353f92e8c"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cert_total}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="298" y="10" width="100" height="14" uuid="959a3404-91e0-4c1e-a828-80491073a732"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[TOTAL BRUTO:]]></text>
			</staticText>
			<staticText>
				<reportElement x="298" y="24" width="100" height="14" uuid="46897a6b-8ffd-4a4c-a96b-35917cbee5ad"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[NOTAS DE CRÉDITO:]]></text>
			</staticText>
			<subreport>
				<reportElement x="437" y="24" width="80" height="28" uuid="027e3ae4-9520-4cd1-8821-100e2afe3db4"/>
				<subreportParameter name="HASTA">
					<subreportParameterExpression><![CDATA[$P{HASTA}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="USUARIO">
					<subreportParameterExpression><![CDATA[$P{USUARIO}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="VALOR_TOTAL">
					<subreportParameterExpression><![CDATA[$F{cert_total}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="DESDE">
					<subreportParameterExpression><![CDATA[$P{DESDE}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "cuadreCaja_valor_nc.jasper"]]></subreportExpression>
			</subreport>
			<textField isBlankWhenNull="true">
				<reportElement x="0" y="57" width="256" height="16" uuid="1e7371af-8659-466a-a5a3-1918d6f15340"/>
				<box leftPadding="2">
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA["GENERADO POR"]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="negrita" x="0" y="73" width="256" height="45" uuid="9846b540-9d46-440e-8418-224c67d95f4b"/>
				<box leftPadding="2">
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Bottom"/>
				<textFieldExpression><![CDATA[$P{TESORERA}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="297" y="57" width="256" height="16" uuid="22438408-4007-448c-ac0e-7fbe5f3724ad"/>
				<box leftPadding="2">
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA["RECIBIDO POR"]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement style="negrita" x="297" y="73" width="256" height="45" uuid="d9211b86-d6ef-455e-ad09-11aaaae5bee5"/>
				<box leftPadding="2">
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Bottom"/>
			</textField>
		</band>
	</summary>
</jasperReport>
