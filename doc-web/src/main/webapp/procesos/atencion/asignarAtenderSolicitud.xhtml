<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/template/bpmTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns="http://www.w3.org/1999/xhtml">
    <ui:define name="title">Trámite</ui:define>
    <ui:define name="head">
        <style type="text/css">
            .ui-panelgrid.form-elements .ui-grc-2 {
                padding-left: 60px;
            }

            @media (max-width:1024px) {
                .ui-panelgrid.form-elements .ui-grc-2 {
                    padding-left: 20px;
                }
            }

            @media (max-width:640px) {
                .ui-panelgrid.form-elements .ui-grc-2 {
                    padding-left: 6px;
                }
            }

            .dialogDemo label {
                line-height: 2.1em;
            }

            .logo {
                width: 5%
            }

            .detail {
                width: 95%;
                padding-left: 25px;
            }

            .detail td {
                font-size: 24px;
            }

            iframe{
                overflow:hidden !important;
            }

            .detail td{
                font-family: 'Sarabun';
                font-size: 20px;
            }
            .panelcard{
                box-shadow: 0 0 0 0 rgba(0,0,0,0.2);
                transition: 0.3s;
            }
            .panelcard:hover{
                box-shadow: 0 5px 10px 0 rgba(0,0,228,0.2);
            }
        </style>
    </ui:define>
    <ui:define name="content">
        <h:form id="formMain" prependId="false">
            <div class="ui-g ui-fluid">
                <div class="ui-g-12">
                    <div class="car card-w-title Wid100" >
                        <h1>
                            <center>
                                #{asignarAtenderSolicitudMB.historicoTramites.tipoTramite.descripcion}    <br/>
                            </center>
                        </h1>
                        <h2>
                            <center>
                                #{asignarAtenderSolicitudMB.historicoTramites.tipoTramite.departamento.nombre}<br/>
                            </center>
                        </h2>
                        <h3>
                            <center>
                                #{asignarAtenderSolicitudMB.taskDataByTaskID.name}<br/>
                            </center>
                        </h3>
                    </div>
                </div>
            </div>
            <p:outputPanel id="btn-rechazar" style="width: 100%; height: 30px ">
                <!--                <p:commandButton icon="fa fa-trash" value="Rechazar Trámite" 
                                                 style="width: auto;float: right; margin-right: 10px; background: #db9486"
                                                 styleClass="rounded-btn"
                                                 process="@this"
                                                 actionListener="# {asignarAtenderSolicitudMB.rechazarTarea()}"/>-->
                <p:commandButton icon="fa fa-times" value="Regresar" 
                                 style="width: auto;float: right; margin-right: 10px; background: #deae34"
                                 styleClass="rounded-btn"
                                 process="@this"
                                 actionListener="#{asignarAtenderSolicitudMB.continuar()}"/>
            </p:outputPanel>
            <center>
                <p:tabView style="width: 80%">
                    <p:tab title="Asignar">
                        <div class="ui-g ui-fluid">
                            <div class="ui-g-12">
                                <div class="car card-w-title Wid100">
                                    <h4>#{asignarAtenderSolicitudMB.historicoTramites.tipoTramite.departamento.nombre} - Usuarios Habilitados</h4>
                                </div>
                            </div>
                            <div class="p-grid">
                                <p:repeat value="#{asignarAtenderSolicitudMB.rolesUsuarios}" var="rolUser" >
                                    <div class="panelcard ui-g-12 ui-md-6  ui-lg-4">
                                        <div class="card user-card" style="border-radius: 3ex !important">
                                            <div class="user-card-content">
                                                <center>
                                                    <div class="user-card-name">
                                                        <p:graphicImage value="#{rolUser.usuario.imagenPerfil}"
                                                                        rendered="#{rolUser.usuario.imagenPerfil!=null}"
                                                                        width="50" height="50"/>
                                                        <p:graphicImage name="images/avatar_hombre.png" 
                                                                        rendered="#{rolUser.usuario.ente.sexo==null 
                                                                                    and rolUser.usuario.imagenPerfil==null}"
                                                                        width="50" height="50" library="paradise-layout"/>
                                                        <p:graphicImage name="images/avatar_mujer.png" 
                                                                        rendered="#{rolUser.usuario.ente.sexo!=null 
                                                                                    and !rolUser.usuario.ente.sexo 
                                                                                    and rolUser.usuario.imagenPerfil==null}"
                                                                        width="50" height="50" library="paradise-layout"/>
                                                        <p:graphicImage name="images/avatar_hombre.png" 
                                                                        rendered="#{rolUser.usuario.ente.sexo!=null 
                                                                                    and rolUser.usuario.ente.sexo 
                                                                                    and rolUser.usuario.imagenPerfil==null}"
                                                                        width="50" height="50" library="paradise-layout"/> 
                                                    </div>
                                                    <br/>
                                                    <div class="user-card-name" 
                                                         style="color: black !important; font-size: 13px !important;
                                                         font-weight: bold;">
                                                        <span>#{rolUser.usuario.ente.nombresApellidos}</span>
                                                    </div>
                                                </center>
                                            </div>
                                            <center>
                                                <p:commandButton icon="fa fa-certificate" value="Asignar" 
                                                                 style="margin-top: 10px; width: auto"
                                                                 styleClass="rounded-btn"
                                                                 process="@this"
                                                                 actionListener="#{asignarAtenderSolicitudMB.asignarUsuario(rolUser.usuario)}"
                                                                 update="frmContinuar"/>
                                            </center>
                                        </div>
                                    </div>
                                </p:repeat>
                            </div>
                        </div>
                    </p:tab>
                    <p:tab title="Atender">
                        <p:panelGrid id="pnlInfo" columns="3" layout="grid" style="margin-top: 5px; width: 98%; vertical-align: top !important" >
                            <h:panelGroup>
                                <h:panelGrid columns="1" style="margin-top: 5px; width: 98%;">
                                    <h:panelGroup>
                                        <p:outputLabel value="# Trámite" /><br/>
                                        <p:outputLabel value="#{asignarAtenderSolicitudMB.historicoTramites.numTramite}" style="font-weight: bold"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="Solicitante" /><br/>
                                        <p:outputLabel value="#{asignarAtenderSolicitudMB.solicitudServicios.enteSolicitante.nombres} #{notifSolicitanteParticipacionMB.solicitudServicios.enteSolicitante.apellidos}" rendered="#{notifInformeParticipacionMB.solicitudServicios.enteSolicitante.esPersona}" style="font-weight: bold"/>
                                        <p:outputLabel value="#{asignarAtenderSolicitudMB.solicitudServicios.enteSolicitante.razonSocial} / #{notifSolicitanteParticipacionMB.solicitudServicios.enteSolicitante.nombreComercial}" rendered="#{!notifInformeParticipacionMB.solicitudServicios.enteSolicitante.esPersona}" style="font-weight: bold"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="Fecha de Ingreso" /><br/>
                                        <p:outputLabel value="#{asignarAtenderSolicitudMB.solicitudServicios.fechaCreacion}" style="font-weight: bold">
                                            <f:convertDateTime pattern="dd-MM-yyyy HH:mm" />
                                        </p:outputLabel>
                                        <br/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel value="Observación" /><br/>
                                        <p:outputLabel value="#{asignarAtenderSolicitudMB.observacion}" style="font-weight: bold"/><br/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel  value="Fecha de visita de Inspección:" /><br/>
                                        <p:calendar  value="#{asignarAtenderSolicitudMB.solicitudServicios.fechaMaximaRespuesta}" 
                                                     mindate="sysdate" showOn="button" />
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:dataList value="#{asignarAtenderSolicitudMB.departamentosSolicitud}" var="deps">
                                            #{deps.nombre}
                                        </p:dataList>
                                    </h:panelGroup>
                                </h:panelGrid>        
                            </h:panelGroup>
                            <h:panelGroup   style="vertical-align: top !important">
                                <p:outputLabel for="observacion" value="Observación" style="font-weight: bold" /><br/>
                                <p:inputTextarea id="observacion" value="#{asignarAtenderSolicitudMB.observacion}" rows="16" cols="120"/>
                            </h:panelGroup>
                        </p:panelGrid>
                        <br/>
                        <center>
                            <p:commandButton value="Continuar"
                                             icon="fa fa-check"
                                             styleClass="info-button rounded-button p-mr-2 p-mb-2"
                                             update="pnlInfo"
                                             actionListener="#{asignarAtenderSolicitudMB.resolver()}"
                                             process="@form" />
                        </center>
                    </p:tab>
                    <p:tab title="Documentos">
                        <h:panelGroup id="panelDocs" >
                            <p:fieldset legend="Documentos">
                                <p:dataTable id="docs" value="#{asignarAtenderSolicitudMB.documentos}" var="doc"
                                             emptyMessage="No existen documentos" rowIndexVar="i">
                                    <p:column headerText="Fecha" style="width: 10%; text-align: center;">
                                        <p:outputLabel value="#{doc.fechaCreacion}" >
                                            <f:convertDateTime pattern="dd-MM-yyyy HH:mm:ss" />
                                        </p:outputLabel>
                                    </p:column>
                                    <p:column headerText="Requisito" style="text-align: center;">
                                        <p:outputLabel value="#{doc.requisito.nombre}" style="float: left;" />
                                    </p:column>
                                    <p:column headerText="Adjuntar Archivo" width="120"  >
                                        <p:selectBooleanCheckbox value="#{doc.check}" rendered="#{doc.rutaArchivo != null}"/>
                                    </p:column>
                                    <!--                                <p:column headerText="Firma Electrónica" style="width: 10%; text-align: center;" >
                                                                        <center>
                                                                            <p:outputLabel value="SI" rendered="# {doc.tieneFirmaElectronica}"/>
                                                                            <p:outputLabel value="NO" rendered="# {!doc.tieneFirmaElectronica}"/>
                                                                        </center>
                                                                    </p:column>-->
                                    <p:column headerText="Acción" style="width: 10%; text-align: center;">
                                        <center>
                                            <p:commandButton  icon="pi pi-bookmark" styleClass="info-button text-button rounded-button p-mr-2 p-mb-2" 
                                                              actionListener="#{asignarAtenderSolicitudMB.getPDF(doc)}"/>    
                                            <p:commandButton  icon="pi pi-download" styleClass="info-button text-button rounded-button p-mr-2 p-mb-2"
                                                              actionListener="#{asignarAtenderSolicitudMB.getDownloadFile(doc)}"/>    
                                        </center>
                                    </p:column>
                                </p:dataTable>
                                <br/>
                                <center>
                                    <p:commandButton  icon="pi pi-envelope" value="Enviar Correo a Solicitante" styleClass="info-button " 
                                                      actionListener="#{asignarAtenderSolicitudMB.enviarCorreo()}"/>    
                                </center>
                            </p:fieldset>
                        </h:panelGroup>
                    </p:tab>
                    <p:tab title="Observaciones">
                        <p:dataTable value="#{asignarAtenderSolicitudMB.observaciones}" var="obs"
                                     emptyMessage="No existen observaciones ingresadas" rowIndexVar="i">
                            <p:column headerText="**" width="50">
                                #{i+1}
                            </p:column>
                            <p:column headerText="Usuario" width="120">
                                #{obs.userCre}
                            </p:column>
                            <p:column headerText="Fecha" width="120">
                                <p:outputLabel value="#{obs.fecCre}" >
                                    <f:convertDateTime pattern="dd-MM-yyyy HH:mm" />
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Observación">
                                #{obs.observacion}
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
            </center>
        </h:form>
        <p:dialog id="observacion" showHeader="false" widgetVar="observacionDlg" 
                  modal="true" height="200" width="400"
                  resizable="false"
                  showEffect="fade" >
            <h:form prependId="false" id="frmContinuar">
                <h3 style="margin-top: 0">Observación</h3>
                <br/>
                <h:panelGrid columns="1" style="width: 100%">
                    <p:inputTextarea value="#{asignarAtenderSolicitudMB.observacion}" rows="6" cols="33" required="true" style="width: 100%"/>
                </h:panelGrid>
                <center>
                    <p:commandButton value="Terminar Trámite"
                                     icon="fa fa-check"
                                     style="width: auto; background: #0081cb;margin-top: 10px;" 
                                     actionListener="#{asignarAtenderSolicitudMB.completarTarea()}"
                                     process="frmContinuar" />

                </center>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
